{"ast":null,"code":"import { Email } from '../../../../config';\nimport { Sweetalert } from '../../../../functions';\nimport { DisputesModel } from '../../../../models/disputes.model';\nimport { Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../services/disputes.service\";\nimport * as i2 from \"../../../../services/users.service\";\nimport * as i3 from \"@angular/common/http\";\nfunction AccountDisputesComponent_tr_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 25);\n    i0.ɵɵtext(2, \"You haven't disputes!\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction AccountDisputesComponent_tr_36_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 27)(1, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function AccountDisputesComponent_tr_36_div_3_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const i_r3 = i0.ɵɵnextContext().index;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.answerDispute(ctx_r3.idDisputes[i_r3]));\n    });\n    i0.ɵɵtext(2, \"Answer dispute\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction AccountDisputesComponent_tr_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵtemplate(3, AccountDisputesComponent_tr_36_div_3_Template, 3, 0, \"div\", 26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\");\n    i0.ɵɵtext(16);\n    i0.ɵɵpipe(17, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"td\");\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const dispute_r5 = ctx.$implicit;\n    const i_r3 = ctx.index;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.idDisputes[i_r3], \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", dispute_r5.answer == null);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", dispute_r5.order, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(8, 9, dispute_r5.date_dispute), \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", dispute_r5.transmitter, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", dispute_r5.receiver, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", dispute_r5.message, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(17, 11, dispute_r5.date_answer), \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", dispute_r5.answer, \" \");\n  }\n}\nexport let AccountDisputesComponent = /*#__PURE__*/(() => {\n  class AccountDisputesComponent {\n    constructor(disputesService, usersService, http) {\n      this.disputesService = disputesService;\n      this.usersService = usersService;\n      this.http = http;\n      this.disputes = [];\n      this.idDisputes = [];\n      this.email = Email.url;\n      this.userDispute = [];\n      this.dtOptions = {};\n      this.dtTrigger = new Subject();\n      this.dispute = new DisputesModel();\n    }\n    ngOnInit() {\n      /*=============================================\n      Agregamos opciones a DataTable\n      =============================================*/\n      this.dtOptions = {\n        pagingType: 'full_numbers',\n        processing: true\n      };\n      let load = 0;\n      /*=============================================\n      Preguntamos si esta tienda tiene disputas\n      =============================================*/\n      this.disputesService.getFilterData(\"receiver\", this.childItem).subscribe(resp => {\n        if (Object.keys(resp).length > 0) {\n          for (const i in resp) {\n            load++;\n            this.disputes.push(resp[i]);\n            this.idDisputes.push(i);\n            /*=============================================\n            Traemos el usuario de la disputa\n            =============================================*/\n            this.usersService.getFilterData(\"username\", resp[i].transmitter).subscribe(resp => {\n              if (Object.keys(resp).length > 0) {\n                for (const i in resp) {\n                  this.userDispute.push(resp[i]);\n                }\n              }\n            });\n          }\n        }\n        if (load == this.disputes.length) {\n          this.dtTrigger.next();\n        }\n      });\n    }\n    /*=============================================\n    Responder Disputa\n    =============================================*/\n    answerDispute(idDispute) {\n      this.idDispute = idDispute;\n      /*=============================================\n      Abrir la ventana modal\n      =============================================*/\n      $(\"#answerDispute\").modal();\n    }\n    /*=============================================\n    Formulario respuesta disputas\n    =============================================*/\n    onSubmit(f) {\n      /*=============================================\n      Validamos formulario para evitar campos vacíos\n      =============================================*/\n      if (f.invalid) {\n        Sweetalert.fnc(\"error\", \"Invalid Request\", null);\n        return;\n      }\n      /*=============================================\n      Actualizamos la disputa en la BD\n      =============================================*/\n      let body = {\n        date_answer: new Date(),\n        answer: this.dispute.answer\n      };\n      this.disputesService.patchDataAuth(this.idDispute, body, localStorage.getItem(\"idToken\")).subscribe(resp => {\n        if (resp[\"name\"] != \"\") {\n          /*=============================================\n          Enviar notificación por correo electrónico\n          =============================================*/\n          const formData = new FormData();\n          formData.append('email', 'yes');\n          formData.append('comment', 'You have received an update on your dispute delivery process');\n          formData.append('url', 'account/my-shopping');\n          formData.append('address', this.userDispute[0].email);\n          formData.append('name', this.userDispute[0].username);\n          this.http.post(this.email, formData).subscribe(resp => {\n            if (resp[\"status\"] == 200) {\n              Sweetalert.fnc(\"success\", \"The dispute has been answered\", \"account/disputes\");\n            }\n          });\n        }\n      }, err => {\n        Sweetalert.fnc(\"error\", err.error.error.message, null);\n      });\n    }\n    /*=============================================\n    Destruímos el trigger de angular\n    =============================================*/\n    ngOnDestroy() {\n      this.dtTrigger.unsubscribe();\n    }\n    static {\n      this.ɵfac = function AccountDisputesComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || AccountDisputesComponent)(i0.ɵɵdirectiveInject(i1.DisputesService), i0.ɵɵdirectiveInject(i2.UsersService), i0.ɵɵdirectiveInject(i3.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AccountDisputesComponent,\n        selectors: [[\"app-account-disputes\"]],\n        inputs: {\n          childItem: \"childItem\"\n        },\n        decls: 57,\n        vars: 5,\n        consts: [[\"f\", \"ngForm\"], [1, \"ps-section__content\"], [1, \"ps-section__links\"], [\"href\", \"/account\"], [\"href\", \"/account/my-shopping\"], [\"href\", \"/account/my-store\"], [\"href\", \"account/my-sales\"], [1, \"table-responsive\", \"mt-4\"], [\"datatable\", \"\", \"width\", \"100%\", 1, \"table\", \"ps-table--whishlist\", \"dt-responsive\", 3, \"dtOptions\", \"dtTrigger\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [\"id\", \"answerDispute\", 1, \"modal\"], [1, \"modal-dialog\"], [1, \"modal-content\"], [3, \"ngSubmit\"], [1, \"modal-header\"], [1, \"modal-title\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", 1, \"close\"], [1, \"modal-body\"], [1, \"form-group\"], [1, \"form-group__content\"], [\"type\", \"text\", \"name\", \"answer\", \"required\", \"\", 1, \"form-control\", 3, \"ngModelChange\", \"ngModel\"], [1, \"modal-footer\"], [1, \"float-right\"], [\"type\", \"submit\", 1, \"btn\", \"btn-warning\", \"btn-lg\"], [\"colspan\", \"8\", 1, \"text-center\"], [\"class\", \"text-center\", 4, \"ngIf\"], [1, \"text-center\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", \"mt-2\", 3, \"click\"]],\n        template: function AccountDisputesComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"div\", 1)(1, \"ul\", 2)(2, \"li\")(3, \"a\", 3);\n            i0.ɵɵtext(4, \"My Wishlist\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(5, \"li\")(6, \"a\", 4);\n            i0.ɵɵtext(7, \"My Shopping\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(8, \"li\")(9, \"a\", 5);\n            i0.ɵɵtext(10, \"My Store\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(11, \"li\")(12, \"a\", 6);\n            i0.ɵɵtext(13, \"My Sales\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(14, \"div\", 7)(15, \"table\", 8)(16, \"thead\")(17, \"tr\")(18, \"th\");\n            i0.ɵɵtext(19, \"Dispute Id\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"th\");\n            i0.ɵɵtext(21, \"Order Id\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(22, \"th\");\n            i0.ɵɵtext(23, \"Date dispute\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(24, \"th\");\n            i0.ɵɵtext(25, \"Transmitter\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(26, \"th\");\n            i0.ɵɵtext(27, \"Receiver\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(28, \"th\");\n            i0.ɵɵtext(29, \"Message\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(30, \"th\");\n            i0.ɵɵtext(31, \"Date Answer\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(32, \"th\");\n            i0.ɵɵtext(33, \"Answer\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(34, \"tbody\");\n            i0.ɵɵtemplate(35, AccountDisputesComponent_tr_35_Template, 3, 0, \"tr\", 9)(36, AccountDisputesComponent_tr_36_Template, 20, 13, \"tr\", 10);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(37, \"div\", 11)(38, \"div\", 12)(39, \"div\", 13)(40, \"form\", 14, 0);\n            i0.ɵɵlistener(\"ngSubmit\", function AccountDisputesComponent_Template_form_ngSubmit_40_listener() {\n              i0.ɵɵrestoreView(_r1);\n              const f_r6 = i0.ɵɵreference(41);\n              return i0.ɵɵresetView(ctx.onSubmit(f_r6));\n            });\n            i0.ɵɵelementStart(42, \"div\", 15)(43, \"h4\", 16);\n            i0.ɵɵtext(44, \"Answer Dispute\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(45, \"button\", 17);\n            i0.ɵɵtext(46, \"\\u00D7\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(47, \"div\", 18)(48, \"div\", 19)(49, \"label\");\n            i0.ɵɵtext(50, \"Type your message\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(51, \"div\", 20)(52, \"textarea\", 21);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AccountDisputesComponent_Template_textarea_ngModelChange_52_listener($event) {\n              i0.ɵɵrestoreView(_r1);\n              i0.ɵɵtwoWayBindingSet(ctx.dispute.answer, $event) || (ctx.dispute.answer = $event);\n              return i0.ɵɵresetView($event);\n            });\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(53, \"div\", 22)(54, \"div\", 23)(55, \"button\", 24);\n            i0.ɵɵtext(56, \"Send\");\n            i0.ɵɵelementEnd()()()()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(15);\n            i0.ɵɵproperty(\"dtOptions\", ctx.dtOptions)(\"dtTrigger\", ctx.dtTrigger);\n            i0.ɵɵadvance(20);\n            i0.ɵɵproperty(\"ngIf\", ctx.disputes.length == 0);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngForOf\", ctx.disputes);\n            i0.ɵɵadvance(16);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.dispute.answer);\n          }\n        },\n        encapsulation: 2\n      });\n    }\n  }\n  return AccountDisputesComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}