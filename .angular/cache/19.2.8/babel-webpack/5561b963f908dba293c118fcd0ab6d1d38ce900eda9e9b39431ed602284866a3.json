{"ast":null,"code":"import { Path } from '../../config';\nimport { DinamicPrice, Quantity, Sweetalert } from '../../functions';\nimport { Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/products.service\";\nimport * as i2 from \"@angular/router\";\nfunction ShoppingCartComponent_tr_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 19);\n    i0.ɵɵtext(2, \"You haven't products in the shopping cart yet!\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ShoppingCartComponent_tr_31_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"div\", 20)(3, \"div\", 21)(4, \"a\", 22);\n    i0.ɵɵelement(5, \"img\", 23);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 24)(7, \"a\", 22);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"div\", 25);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(10, \"td\", 26);\n    i0.ɵɵelementStart(11, \"td\", 27);\n    i0.ɵɵtext(12, \"$\");\n    i0.ɵɵelementStart(13, \"span\", 28);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"td\")(16, \"div\", 29)(17, \"button\", 30);\n    i0.ɵɵlistener(\"click\", function ShoppingCartComponent_tr_31_Template_button_click_17_listener() {\n      const ctx_r1 = i0.ɵɵrestoreView(_r1);\n      const product_r3 = ctx_r1.$implicit;\n      const i_r4 = ctx_r1.index;\n      const quantity_r5 = i0.ɵɵreference(22);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.changeQuantity(quantity_r5.value, 1, \"up\", product_r3.url, product_r3.listDetails, i_r4));\n    });\n    i0.ɵɵtext(18, \" +\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function ShoppingCartComponent_tr_31_Template_button_click_19_listener() {\n      const ctx_r6 = i0.ɵɵrestoreView(_r1);\n      const product_r3 = ctx_r6.$implicit;\n      const i_r4 = ctx_r6.index;\n      const quantity_r5 = i0.ɵɵreference(22);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.changeQuantity(quantity_r5.value, 1, \"down\", product_r3.url, product_r3.listDetails, i_r4));\n    });\n    i0.ɵɵtext(20, \" -\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"input\", 32, 0);\n    i0.ɵɵlistener(\"change\", function ShoppingCartComponent_tr_31_Template_input_change_21_listener() {\n      const ctx_r7 = i0.ɵɵrestoreView(_r1);\n      const product_r3 = ctx_r7.$implicit;\n      const i_r4 = ctx_r7.index;\n      const quantity_r5 = i0.ɵɵreference(22);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.changeQuantity(quantity_r5.value, 0, null, product_r3.url, product_r3.listDetails, i_r4));\n    });\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(23, \"td\", 33);\n    i0.ɵɵelement(24, \"div\", 34);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"td\")(26, \"a\", 35);\n    i0.ɵɵlistener(\"confirm\", function ShoppingCartComponent_tr_31_Template_a_confirm_26_listener() {\n      const product_r3 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.removeProduct(product_r3.url, product_r3.listDetails));\n    });\n    i0.ɵɵelement(27, \"i\", 36);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtext(28);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const product_r3 = ctx.$implicit;\n    const lastIndex_r9 = ctx.last;\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵpropertyInterpolate1(\"href\", \"product/\", product_r3.url, \"\", i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance();\n    i0.ɵɵpropertyInterpolate3(\"src\", \"\", ctx_r5.path, \"img/products/\", product_r3.category, \"/\", product_r3.image, \"\", i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"href\", \"product/\", product_r3.url, \"\", i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(product_r3.name);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"innerHTML\", product_r3.details, i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"innerHTML\", product_r3.price, i0.ɵɵsanitizeHtml);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(product_r3.shipping);\n    i0.ɵɵadvance(7);\n    i0.ɵɵpropertyInterpolate(\"value\", product_r3.quantity);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"popoverMessage\", ctx_r5.popoverMessage);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", lastIndex_r9 ? ctx_r5.callback() : \"\", \" \");\n  }\n}\nfunction ShoppingCartComponent_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 37);\n    i0.ɵɵelement(1, \"div\", 25);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"innerHTML\", ctx_r5.totalP, i0.ɵɵsanitizeHtml);\n  }\n}\nfunction ShoppingCartComponent_a_41_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"a\", 38);\n    i0.ɵɵtext(1, \" Proceed to checkout \");\n    i0.ɵɵelement(2, \"i\", 39);\n    i0.ɵɵelementEnd();\n  }\n}\nexport let ShoppingCartComponent = /*#__PURE__*/(() => {\n  class ShoppingCartComponent {\n    constructor(productsService, router) {\n      this.productsService = productsService;\n      this.router = router;\n      this.path = Path.url;\n      this.shoppingCart = [];\n      this.totalShoppingCart = 0;\n      this.render = true;\n      this.totalP = `<div class=\"p-2\"><h3>Total <span class=\"totalP\"><div class=\"spinner-border\"></div></span></h3></div>   `;\n      this.dtOptions = {};\n      this.dtTrigger = new Subject();\n      this.popoverMessage = 'Are you sure to remove it?';\n    }\n    ngOnInit() {\n      /*=============================================\n      Agregamos opciones a DataTable\n      =============================================*/\n      this.dtOptions = {\n        pagingType: 'full_numbers',\n        processing: true\n      };\n      /*=============================================\n      Tomamos la data del Carrito de Compras del LocalStorage\n      =============================================*/\n      if (localStorage.getItem(\"list\")) {\n        let list = JSON.parse(localStorage.getItem(\"list\"));\n        this.totalShoppingCart = list.length;\n        /*=============================================\n        Recorremos el arreglo del listado\n        =============================================*/\n        let load = 0;\n        for (const i in list) {\n          /*=============================================\n          Filtramos los productos del carrito de compras\n          =============================================*/\n          this.productsService.getFilterData(\"url\", list[i].product).subscribe(resp => {\n            for (const f in resp) {\n              load++;\n              let details = `<div class=\"list-details small text-secondary\">`;\n              if (list[i].details.length > 0) {\n                let specification = JSON.parse(list[i].details);\n                for (const i in specification) {\n                  let property = Object.keys(specification[i]);\n                  for (const f in property) {\n                    details += `<div>${property[f]}: ${specification[i][property[f]]}</div>`;\n                  }\n                }\n              } else {\n                /*=============================================\n                Mostrar los detalles por defecto del producto\n                =============================================*/\n                if (resp[f].specification != \"\") {\n                  let specification = JSON.parse(resp[f].specification);\n                  for (const i in specification) {\n                    let property = Object.keys(specification[i]).toString();\n                    details += `<div>${property}: ${specification[i][property][0]}</div>`;\n                  }\n                }\n              }\n              details += `</div>`;\n              this.shoppingCart.push({\n                url: resp[f].url,\n                name: resp[f].name,\n                category: resp[f].category,\n                image: resp[f].image,\n                delivery_time: resp[f].delivery_time,\n                quantity: list[i].unit,\n                price: DinamicPrice.fnc(resp[f])[0],\n                shipping: Number(resp[f].shipping) * Number(list[i].unit),\n                details: details,\n                listDetails: list[i].details\n              });\n              if (load == list.length) {\n                this.dtTrigger.next();\n              }\n            }\n          });\n        }\n      }\n    }\n    /*=============================================\n    Función Callback\n    =============================================*/\n    callback() {\n      if (this.render) {\n        this.render = false;\n        this.totalPrice(this.totalShoppingCart);\n        setTimeout(function () {\n          Quantity.fnc();\n        }, this.totalShoppingCart * 100);\n      }\n    }\n    /*=============================================\n    Función cambio de cantidad\n    =============================================*/\n    changeQuantity(quantity, unit, move, product, details, index) {\n      let number = 1;\n      /*=============================================\n      Controlar máximos y mínimos de la cantidad\n      =============================================*/\n      if (Number(quantity) > 9) {\n        quantity = 9;\n      }\n      if (Number(quantity) < 1) {\n        quantity = 1;\n      }\n      /*=============================================\n      Modificar cantidad de acuerdo a la dirección\n      =============================================*/\n      if (move == \"up\" && Number(quantity) < 9) {\n        number = Number(quantity) + unit;\n      } else if (move == \"down\" && Number(quantity) > 1) {\n        number = Number(quantity) - unit;\n      } else {\n        number = Number(quantity);\n      }\n      /*=============================================\n      Actualizar la variable list del localStorage\n      =============================================*/\n      if (localStorage.getItem(\"list\")) {\n        let shoppingCart = JSON.parse(localStorage.getItem(\"list\"));\n        shoppingCart.forEach(list => {\n          if (list.product == product && list.details == details.toString()) {\n            list.unit = number;\n          }\n        });\n        this.shoppingCart[index].quantity = number;\n        localStorage.setItem(\"list\", JSON.stringify(shoppingCart));\n        this.totalPrice(shoppingCart.length);\n      }\n    }\n    /*=============================================\n    Actualizar subtotal y total\n    =============================================*/\n    totalPrice(totalShoppingCart) {\n      let localShoppingCart = this.shoppingCart;\n      setTimeout(function () {\n        function price() {\n          let price = $(\".pShoppingCart .end-price\");\n          let quantity = $(\".qShoppingCart\");\n          let shipping = $(\".sShoppingCart\");\n          let subTotalPrice = $(\".subTotalPrice\");\n          let total = 0;\n          for (let i = 0; i < price.length; i++) {\n            /*=============================================\n            Sumar precio con envío\n            =============================================*/\n            let shipping_price = Number($(price[i]).html()) + Number($(shipping[i]).html());\n            /*=============================================\n            Multiplicar cantidad por precio con envío\n            =============================================*/\n            let subTotal = Number($(quantity[i]).val()) * shipping_price;\n            /*=============================================\n            Mostramos subtotales de cada producto\n            =============================================*/\n            $(subTotalPrice[i]).html(`$${subTotal.toFixed(2)}`);\n          }\n          /*=============================================\n          Definimos el total de los precios\n          =============================================*/\n          localShoppingCart.forEach(value => {\n            let start = value.price.substr(54);\n            let end = start.slice(0, -11);\n            total += (Number(end) + Number(value.shipping)) * Number(value.quantity);\n          });\n          $(\".totalP\").html(`$${total.toFixed(2)}`);\n        }\n        price();\n        /*=============================================\n        Función para saber cuando pasamos de página en DataTable\n        =============================================*/\n        $(\".table\").on(\"draw.dt\", function () {\n          price();\n        });\n      }, totalShoppingCart * 100);\n    }\n    /*=============================================\n    Función para remover productos de la lista de carrito de compras\n    =============================================*/\n    removeProduct(product, details) {\n      /*=============================================\n      Buscamos coincidencia para remover el producto\n      =============================================*/\n      if (localStorage.getItem(\"list\")) {\n        let shoppingCart = JSON.parse(localStorage.getItem(\"list\"));\n        shoppingCart.forEach((list, index) => {\n          if (list.product == product && list.details == details.toString()) {\n            shoppingCart.splice(index, 1);\n          }\n        });\n        /*=============================================\n        Actualizamos en LocalStorage la lista del carrito de compras\n        =============================================*/\n        localStorage.setItem(\"list\", JSON.stringify(shoppingCart));\n        Sweetalert.fnc(\"success\", \"product removed\", this.router.url);\n      }\n    }\n    /*=============================================\n    Destruímos el trigger de angular\n    =============================================*/\n    ngOnDestroy() {\n      this.dtTrigger.unsubscribe();\n    }\n    static {\n      this.ɵfac = function ShoppingCartComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ShoppingCartComponent)(i0.ɵɵdirectiveInject(i1.ProductsService), i0.ɵɵdirectiveInject(i2.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ShoppingCartComponent,\n        selectors: [[\"app-shopping-cart\"]],\n        decls: 42,\n        vars: 6,\n        consts: [[\"quantity\", \"\"], [1, \"ps-breadcrumb\"], [1, \"container\"], [1, \"breadcrumb\"], [\"routerLink\", \"/\"], [1, \"ps-section--shopping\", \"ps-shopping-cart\"], [1, \"ps-section__header\"], [1, \"ps-section__content\"], [1, \"table-responsive\"], [\"datatable\", \"\", 1, \"table\", \"ps-table--shopping-cart\", 3, \"dtOptions\", \"dtTrigger\"], [4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [1, \"d-block\", \"d-lg-none\", \"text-right\", \"text-muted\", \"py-3\"], [1, \"fas\", \"fa-long-arrow-alt-right\"], [\"class\", \"d-flex flex-row-reverse\", 4, \"ngIf\"], [1, \"ps-section__cart-actions\"], [\"routerLink\", \"/\", 1, \"ps-btn\"], [1, \"icon-arrow-left\"], [\"class\", \"ps-btn\", \"href\", \"checkout\", 4, \"ngIf\"], [\"colspan\", \"6\", 1, \"text-center\"], [1, \"ps-product--cart\"], [1, \"ps-product__thumbnail\"], [3, \"href\"], [3, \"src\"], [1, \"ps-product__content\"], [3, \"innerHTML\"], [1, \"ps-product\", \"pShoppingCart\", 3, \"innerHTML\"], [1, \"text-center\"], [1, \"sShoppingCart\"], [1, \"form-group--number\", \"quantity\"], [1, \"up\", 3, \"click\"], [1, \"down\", 3, \"click\"], [\"type\", \"text\", \"readonly\", \"\", 1, \"form-control\", \"qShoppingCart\", 3, \"change\", \"value\"], [1, \"subTotalPrice\"], [1, \"spinner-border\", \"subTotalPriceM\"], [\"mwlConfirmationPopover\", \"\", \"placement\", \"left\", 2, \"cursor\", \"pointer\", 3, \"confirm\", \"popoverMessage\"], [1, \"icon-cross\"], [1, \"d-flex\", \"flex-row-reverse\"], [\"href\", \"checkout\", 1, \"ps-btn\"], [1, \"icon-arrow-right\"]],\n        template: function ShoppingCartComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"ul\", 3)(3, \"li\")(4, \"a\", 4);\n            i0.ɵɵtext(5, \"Home\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(6, \"li\");\n            i0.ɵɵtext(7, \"Shopping cart\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(8, \"div\", 5)(9, \"div\", 2)(10, \"div\", 6)(11, \"h1\");\n            i0.ɵɵtext(12, \"Shopping Cart\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(13, \"div\", 7)(14, \"div\", 8)(15, \"table\", 9)(16, \"thead\")(17, \"tr\")(18, \"th\");\n            i0.ɵɵtext(19, \"Product name\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"th\");\n            i0.ɵɵtext(21, \"PRICE\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(22, \"th\");\n            i0.ɵɵtext(23, \"SHIPPING\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(24, \"th\");\n            i0.ɵɵtext(25, \"QUANTITY\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(26, \"th\");\n            i0.ɵɵtext(27, \"TOTAL\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(28, \"th\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(29, \"tbody\");\n            i0.ɵɵtemplate(30, ShoppingCartComponent_tr_30_Template, 3, 0, \"tr\", 10)(31, ShoppingCartComponent_tr_31_Template, 29, 15, \"tr\", 11);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(32, \"h4\", 12);\n            i0.ɵɵtext(33, \" Move to \");\n            i0.ɵɵelement(34, \"i\", 13);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(35, \"hr\");\n            i0.ɵɵtemplate(36, ShoppingCartComponent_div_36_Template, 2, 1, \"div\", 14);\n            i0.ɵɵelementStart(37, \"div\", 15)(38, \"a\", 16);\n            i0.ɵɵelement(39, \"i\", 17);\n            i0.ɵɵtext(40, \" Back to Shop \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(41, ShoppingCartComponent_a_41_Template, 3, 0, \"a\", 18);\n            i0.ɵɵelementEnd()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(15);\n            i0.ɵɵproperty(\"dtOptions\", ctx.dtOptions)(\"dtTrigger\", ctx.dtTrigger);\n            i0.ɵɵadvance(15);\n            i0.ɵɵproperty(\"ngIf\", ctx.shoppingCart.length == 0);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngForOf\", ctx.shoppingCart);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ctx.shoppingCart.length > 0);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ctx.shoppingCart.length > 0);\n          }\n        },\n        encapsulation: 2\n      });\n    }\n  }\n  return ShoppingCartComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}