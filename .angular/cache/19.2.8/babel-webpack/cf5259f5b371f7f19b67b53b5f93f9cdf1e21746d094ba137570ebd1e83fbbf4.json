{"ast":null,"code":"import { Api, Register, Login, SendEmailVerification, ConfirmEmailVerification, GetUserData, SendPasswordResetEmail, VerifyPasswordResetCode, ConfirmPasswordReset, ChangePassword } from '../config';\nimport { Sweetalert } from '../functions';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"../services/products.service\";\nexport let UsersService = /*#__PURE__*/(() => {\n  class UsersService {\n    constructor(http, productsService) {\n      this.http = http;\n      this.productsService = productsService;\n      this.api = Api.url;\n      this.register = Register.url;\n      this.login = Login.url;\n      this.sendEmailVerification = SendEmailVerification.url;\n      this.confirmEmailVerification = ConfirmEmailVerification.url;\n      this.getUserData = GetUserData.url;\n      this.sendPasswordResetEmail = SendPasswordResetEmail.url;\n      this.verifyPasswordResetCode = VerifyPasswordResetCode.url;\n      this.confirmPasswordReset = ConfirmPasswordReset.url;\n      this.changePassword = ChangePassword.url;\n    }\n    /*=============================================\n    Registro en Firebase Authentication\n    =============================================*/\n    registerAuth(user) {\n      return this.http.post(`${this.register}`, user);\n    }\n    /*=============================================\n    Registro en Firebase Database\n    =============================================*/\n    registerDatabase(user) {\n      delete user.first_name;\n      delete user.last_name;\n      delete user.password;\n      delete user.returnSecureToken;\n      return this.http.post(`${this.api}/users.json`, user);\n    }\n    /*=============================================\n    Filtrar data para buscar coincidencias\n    =============================================*/\n    getFilterData(orderBy, equalTo) {\n      return this.http.get(`${this.api}users.json?orderBy=\"${orderBy}\"&equalTo=\"${equalTo}\"&print=pretty`);\n    }\n    /*=============================================\n    Login en Firebase Authentication\n    =============================================*/\n    loginAuth(user) {\n      return this.http.post(`${this.login}`, user);\n    }\n    /*=============================================\n    Enviar verificación de correo electrónico\n    =============================================*/\n    sendEmailVerificationFnc(body) {\n      return this.http.post(`${this.sendEmailVerification}`, body);\n    }\n    /*=============================================\n    Confirmar email de verificación\n    =============================================*/\n    confirmEmailVerificationFnc(body) {\n      return this.http.post(`${this.confirmEmailVerification}`, body);\n    }\n    /*=============================================\n    Actualizar data de usuario\n    =============================================*/\n    patchData(id, value) {\n      return this.http.patch(`${this.api}users/${id}.json`, value);\n    }\n    /*=============================================\n    Validar idToken de Autenticación\n    =============================================*/\n    authActivate() {\n      return new Promise(resolve => {\n        /*=============================================\n        Validamos que el idToken sea real\n        =============================================*/\n        if (localStorage.getItem(\"idToken\")) {\n          let body = {\n            idToken: localStorage.getItem(\"idToken\")\n          };\n          this.http.post(`${this.getUserData}`, body).subscribe(resp => {\n            /*=============================================\n            Validamos fecha de expiración\n            =============================================*/\n            if (localStorage.getItem(\"expiresIn\")) {\n              let expiresIn = Number(localStorage.getItem(\"expiresIn\"));\n              let expiresDate = new Date();\n              expiresDate.setTime(expiresIn);\n              if (expiresDate > new Date()) {\n                resolve(true);\n              } else {\n                localStorage.removeItem('idToken');\n                localStorage.removeItem('expiresIn');\n                resolve(false);\n              }\n            } else {\n              localStorage.removeItem('idToken');\n              localStorage.removeItem('expiresIn');\n              resolve(false);\n            }\n          }, err => {\n            localStorage.removeItem('idToken');\n            localStorage.removeItem('expiresIn');\n            resolve(false);\n          });\n        } else {\n          localStorage.removeItem('idToken');\n          localStorage.removeItem('expiresIn');\n          resolve(false);\n        }\n      });\n    }\n    /*=============================================\n    Resetear la contraseña\n    =============================================*/\n    sendPasswordResetEmailFnc(body) {\n      return this.http.post(`${this.sendPasswordResetEmail}`, body);\n    }\n    /*=============================================\n    Confirmar el cambio de la contraseña\n    =============================================*/\n    verifyPasswordResetCodeFnc(body) {\n      return this.http.post(`${this.verifyPasswordResetCode}`, body);\n    }\n    /*=============================================\n    Enviar la contraseña\n    =============================================*/\n    confirmPasswordResetFnc(body) {\n      return this.http.post(`${this.confirmPasswordReset}`, body);\n    }\n    /*=============================================\n    Cambiar la contraseña\n    =============================================*/\n    changePasswordFnc(body) {\n      return this.http.post(`${this.changePassword}`, body);\n    }\n    /*=============================================\n    Tomar información de un solo usuario\n    =============================================*/\n    getUniqueData(value) {\n      return this.http.get(`${this.api}users/${value}.json`);\n    }\n    /*=============================================\n    Función para agregar productos a la lista de deseos\n    =============================================*/\n    addWishlist(product) {\n      /*=============================================\n      Validamos que el usuario esté autenticado\n      =============================================*/\n      this.authActivate().then(resp => {\n        if (!resp) {\n          Sweetalert.fnc(\"error\", \"The user must be logged in\", null);\n          return;\n        } else {\n          /*=============================================\n          Traemos la lista de deseos que ya tenga el usuario\n          =============================================*/\n          this.getFilterData(\"idToken\", localStorage.getItem(\"idToken\")).subscribe(resp => {\n            /*=============================================\n            Capturamos el id del usuario\n            =============================================*/\n            let id = Object.keys(resp).toString();\n            for (const i in resp) {\n              /*=============================================\n              Pregutnamos si existe una lista de deseos\n              =============================================*/\n              if (resp[i].wishlist != undefined) {\n                let wishlist = JSON.parse(resp[i].wishlist);\n                let length = 0;\n                /*=============================================\n                Pregutnamos si existe un producto en la lista de deseos\n                =============================================*/\n                if (wishlist.length > 0) {\n                  wishlist.forEach((list, index) => {\n                    if (list == product) {\n                      length--;\n                    } else {\n                      length++;\n                    }\n                  });\n                  /*=============================================\n                  Preguntamos si no ha agregado este producto a la lista de deseos anteriormente\n                  =============================================*/\n                  if (length != wishlist.length) {\n                    Sweetalert.fnc(\"error\", \"It already exists on your wishlist\", null);\n                  } else {\n                    wishlist.push(product);\n                    let body = {\n                      wishlist: JSON.stringify(wishlist)\n                    };\n                    this.patchData(id, body).subscribe(resp => {\n                      if (resp[\"wishlist\"] != \"\") {\n                        let totalWishlist = Number($(\".totalWishlist\").html());\n                        $(\".totalWishlist\").html(totalWishlist + 1);\n                        Sweetalert.fnc(\"success\", \"Product added to wishlist\", null);\n                      }\n                    });\n                  }\n                } else {\n                  wishlist.push(product);\n                  let body = {\n                    wishlist: JSON.stringify(wishlist)\n                  };\n                  this.patchData(id, body).subscribe(resp => {\n                    if (resp[\"wishlist\"] != \"\") {\n                      let totalWishlist = Number($(\".totalWishlist\").html());\n                      $(\".totalWishlist\").html(totalWishlist + 1);\n                      Sweetalert.fnc(\"success\", \"Product added to wishlist\", null);\n                    }\n                  });\n                }\n                /*=============================================\n                Cuando no exista lista de deseos inicialmente\n                =============================================*/\n              } else {\n                let body = {\n                  wishlist: `[\"${product}\"]`\n                };\n                this.patchData(id, body).subscribe(resp => {\n                  if (resp[\"wishlist\"] != \"\") {\n                    let totalWishlist = Number($(\".totalWishlist\").html());\n                    $(\".totalWishlist\").html(totalWishlist + 1);\n                    Sweetalert.fnc(\"success\", \"Product added to wishlist\", null);\n                  }\n                });\n              }\n            }\n          });\n        }\n      });\n    }\n    /*=============================================\n    Función para agregar productos al carrito de compras\n    =============================================*/\n    addSoppingCart(item) {\n      /*=============================================\n      Filtramos el producto en la data\n      =============================================*/\n      this.productsService.getFilterData(\"url\", item[\"product\"]).subscribe(resp => {\n        /*=============================================\n        Recorremos el producto para encontrar su información\n        =============================================*/\n        for (const i in resp) {\n          /*=============================================\n          Preguntamos primero que el producto tenga stock\n          =============================================*/\n          if (resp[i][\"stock\"] == 0) {\n            Sweetalert.fnc(\"error\", \"Out of Stock\", null);\n            return;\n          }\n          /*=============================================\n          Preguntamos si el item detalles viene vacío\n          =============================================*/\n          if (item[\"details\"].length == 0) {\n            if (resp[i].specification != \"\") {\n              let specification = JSON.parse(resp[i].specification);\n              item[\"details\"] = `[{`;\n              for (const i in specification) {\n                let property = Object.keys(specification[i]).toString();\n                item[\"details\"] += `\"${property}\":\"${specification[i][property][0]}\",`;\n              }\n              item[\"details\"] = item[\"details\"].slice(0, -1);\n              item[\"details\"] += `}]`;\n            }\n          }\n        }\n      });\n      /*=============================================\n      Agregamos al LocalStorage la variable listado carrito de compras\n      =============================================*/\n      if (localStorage.getItem(\"list\")) {\n        let arrayList = JSON.parse(localStorage.getItem(\"list\"));\n        /*=============================================\n        Preguntar si el producto se repite\n        =============================================*/\n        let count = 0;\n        let index;\n        for (const i in arrayList) {\n          if (arrayList[i].product == item[\"product\"] && arrayList[i].details.toString() == item[\"details\"].toString()) {\n            count--;\n            index = i;\n          } else {\n            count++;\n          }\n        }\n        /*=============================================\n        Validamos si el producto se repite\n        =============================================*/\n        if (count == arrayList.length) {\n          arrayList.push(item);\n        } else {\n          arrayList[index].unit += item[\"unit\"];\n        }\n        localStorage.setItem(\"list\", JSON.stringify(arrayList));\n        Sweetalert.fnc(\"success\", \"Product added to Shopping Cart\", item[\"url\"]);\n      } else {\n        let arrayList = [];\n        arrayList.push(item);\n        localStorage.setItem(\"list\", JSON.stringify(arrayList));\n        Sweetalert.fnc(\"success\", \"Product added to Shopping Cart\", item[\"url\"]);\n      }\n    }\n    /*=============================================\n    Función para tomar la lista de países\n    =============================================*/\n    getCountries() {\n      return this.http.get('./assets/json/countries.json');\n    }\n    static {\n      this.ɵfac = function UsersService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || UsersService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.ProductsService));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: UsersService,\n        factory: UsersService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return UsersService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}